<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Tank Thinks: Why Clojure is Great: Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
    <link href="/css/asciidoc.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <h1><a class="navbar-brand" href="/index.html">Tank Thinks</a></h1>
            </div>
            <!-- nav links -->
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li ><a href="/index.html">Home</a></li>
                    <li ><a href="/archives.html">Archives</a></li>
                    
                    <li><a href="/feed.xml">RSS</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>

    <div id="wrapper" class="container">
        <div class="row">
            <div class="col-md-8">
                <div id="content">
                
<div id="post">
    <div id="post-header">
    <h2>Why Clojure is Great: Data</h2>
    <div id="post-meta">
        
    </div>
</div>
<div>
    
    <div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>It is better to have 100 functions operate on one data structure than 10 functions on 10 data structures.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Alan Perlis
</div>
</div>
<div class="paragraph">
<p>You&#8217;ve probably seen this quote before. I&#8217;ve seen in in countless blogs and books. It is referenced in the wonderful Clojure book <a href="http://joyofclojure.com/">The Joy of Clojure</a>. I recently experienced the joy of Clojure directly through Perlis' pearl of wisdom (all puns intended).</p>
</div>
<div class="paragraph">
<p>I recently read a nice blog post on avoiding <a href="http://www.javacodegeeks.com/2014/05/clojure-how-to-prevent-expected-map-got-vector-and-similar-errors.html">unexpected issues</a> in Clojure functions. I like the advice: small fns, destructuring and pre/post conditions so thought I would integrate it into a few functions. The epiphany came with the pre/post conditions.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple function that transforms a list to a vector.</p>
</div>
<pre class="brush: clojure">
(defn list->vector
  [xs]
  (reduce conj [] xs))
</pre>
<div class="paragraph">
<p>I want to add pre/post conditions to this simple function, but I can&#8217;t seem to remember the syntax. Let&#8217;s see if I can figure it out using the Clojure composite data types: set, vector, list and map.</p>
</div>
<div class="paragraph">
<p>First: there are two named types of conditions, <code>:pre</code> and <code>:post</code>. Well the Clojure composite data type that supports named associations is a map, does this look right:</p>
</div>
<pre class="brush: clojure">
{:pre nil :post nil}
</pre>
<div class="paragraph">
<p>Second, let&#8217;s think of what the values for each of the <code>:pre</code> and <code>:post</code> keys should be. It seems reasonable that there could be more than one <code>:pre</code> function and more than one <code>:post</code> function, so each value should be a collection of some sort. We don&#8217;t really need to name the elements of these collections, but some sort of sequential collection makes sense so that the Clojure internals can apply the functions in order. In fact, doesn&#8217;t <code>seq</code> makes sense because I&#8217;m sure the Clojure internals would love to use first <code>first</code> and <code>rest</code> to apply a collection of somethings. It seems the choice is between <code>list</code> and <code>vector</code>, and when choosing between a list and vector, we usually use vectors unless we are generating code forms because of the nice visual offset of the <code>[]</code>, so a vector makes sense for each value:</p>
</div>
<pre class="brush: clojure">
{:pre [] :post []}
</pre>
<div class="paragraph">
<p>Lastly, we know that we are creating pre and post conditions, which are functions, so there&#8217;s only one Clojure data types for this job, <code>list</code>, I&#8217;ve filled in each of the :pre and :post vectors with two functions that just have a bunk name "fn" and some "args".</p>
</div>
<pre class="brush: clojure">
{:pre [(fn args) (fn args))] :post [(fn args) (fn args))]}
</pre>
<div class="paragraph">
<p>Let&#8217;s say that we want our functions to ensure that our input is a list and not empty and our output is a vector and not empty; putting it all together:</p>
</div>
<pre class="brush: clojure">
(defn list->vector
  [xs]
  {:pre [(list? xs) (not (empty? xs))] :post [(vector? %) (not (empty? %))]}
  (reduce conj [] xs))
[1 2 3]
AssertionError Assert failed: (list? xs)  user/list->vector (form-init2119333260165711694.clj:1)
AssertionError Assert failed: (not (empty? xs))  user/list->vector (form-init2119333260165711694.clj:1)
</pre>
<div class="paragraph">
<p>Imagine trying the same process of discovery in Java for example without the aid of an IDE to show you the available methods on each object. It would be nearly impossible to do this in Java because most bits of data are wrapped in Objects with named fields and methods. This is one of the reasons Clojure is so intuitively powerful. And one of the reasons Perlis was so right.</p>
</div>
</div>
<div class="date">May 5, 2014</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/cryogen.html">cryogen</a>
    
    <a href="/asciidoc.html">asciidoc</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts/2014-05-27-java-service-rpm-example.html">&laquo; Java Service RPM Example</a>
        
        
        ||
        
        
        <a href="/posts/2014-04-04-refocus-simplify-1.html">Simplify and Focus Learning &raquo;</a>
        
    </div>

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//tankthinks.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    


</div>

                </div>
            </div>

            <div class="col-md-3">
                <div id="sidebar">
                    <h3>Links</h3>
                    <ul id="links">
                        
                    </ul>
                    <div id="recent">
                        <h3>Recent Posts</h3>
                        <ul>
                        
                        <li><a href="/posts/2016-12-23-arachne.html">Arachne</a></li>
                        
                        <li><a href="/posts/2016-12-21-research-group-introduction.html">Research Group Introduction and Application</a></li>
                        
                        <li><a href="/posts/2016-12-07-introduction-to-clojure.html">Introduction to Clojure</a></li>
                        
                        </ul>
                    </div>
                    <div id="tags">
                        <h3>Tags</h3>
                        <ul>
                        
                        <li><a href="/dynamic.html">dynamic</a></li>
                        
                        <li><a href="/static.html">static</a></li>
                        
                        <li><a href="/cryogen.html">cryogen</a></li>
                        
                        <li><a href="/learning.html">learning</a></li>
                        
                        <li><a href="/clojure.html">clojure</a></li>
                        
                        <li><a href="/aws.html">aws</a></li>
                        
                        <li><a href="/3tilt.html">3tilt</a></li>
                        
                        <li><a href="/booknote.html">booknote</a></li>
                        
                        <li><a href="/failure.html">failure</a></li>
                        
                        <li><a href="/asciidoc.html">asciidoc</a></li>
                        
                        <li><a href="/languages.html">languages</a></li>
                        
                        <li><a href="/presentation.html">presentation</a></li>
                        
                        <li><a href="/brain.html">brain</a></li>
                        
                        <li><a href="/docker.html">docker</a></li>
                        
                        <li><a href="/cuwab.html">cuwab</a></li>
                        
                        <li><a href="/sketchnote.html">sketchnote</a></li>
                        
                        <li><a href="/clojure-conj-2015.html">clojure-conj-2015</a></li>
                        
                        <li><a href="/research-group.html">research-group</a></li>
                        
                        <li><a href="/arachne.html">arachne</a></li>
                        
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer>Copyright &copy; 2014 BLOGAWESOME
            <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
    </div>
        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
        <script src="/js/highlight.pack.js" type="text/javascript"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
